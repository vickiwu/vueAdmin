# 声明一些参数
variables:
  # DOCKER_HOST: tcp://{dockerIp}:80
# 定义 stages（阶段，会依次执行）
stages:
  - pull_code_test
  - pull_code_production
  - install_deps
  - build_prod
  - deploy_prod

cache:
  key: ${CI_BUILD_REF_NAME}
  paths:
    - node_modules/
    - dist

# # 拉取代码
# pull_code_test:
#   stage: pull_code_test
#   only:
#     - master
#   script:
#      - cd ${GIT_DIR}/${PROJECT}
#      - git pull origin master

# pull_code_production:
#   stage: pull_code_production
#   only:
#     - master
#   script:
#     - cd ${GIT_DIR}/${PROJECT}
#     - git pull origin master

# 安装构建依赖
install_deps_job:
  stage: install_deps
  # 在哪个分支才会执行脚本
  only:
    # - dev
    # - release
    - master
  script:
    - echo '模拟安装构建依赖阶段'
  tags:
    - vue

# 构建预prod环境src目录下应用
build_prod_job:
  stage: build_prod
  only:
    - master
  script:
    - echo '构建预prod环境src目录下应用阶段'
  tags:
    - vue

# 部署生产环境
deploy_prod_job:
  stage: deploy_prod
  only:
    - master
  script:
    - echo '部署生产环境阶段'
  tags:
    - vue

